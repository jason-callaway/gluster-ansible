# vim: set ft=ansible:
---
- hosts: localhost
  connection: local
  become: False
  gather_facts: no
  vars_files:
    - vars.yaml

- include: create_vpc.yaml

# Set up security groups for the VPC
- include: create_security_groups.yaml
  vars:
    vpc_id: "{{ vpc.vpc_id }}"

# Create Route 53 entries
- include: create_route53.yaml

# Create Gluster nodes
- include: create_nodes.yaml
  vars:
    sides:
      - subnet: "{{ vpc.subnets.0.id }}"
        side_tag: "side_a"
      - subnet: "{{ vpc.subnets.1.id }}"
        side_tag: "side_b"
    sg_group_id: "{{ group.group_id }}"

# Update the security rules
- include: update_security_group.yaml
  vars:
    vpc_id: "{{ vpc.vpc_id }}"

# Install and configure Gluster
#- include: install_gluster.yaml